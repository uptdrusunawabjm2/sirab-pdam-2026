<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Input Petugas PDAM</title>

<style>
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

:root{
  --pri:#2d7cff;
  --pri-light:#eef5ff;
  --txt:#1e293b;
  --gray:#64748b;
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#cbd5e1;
  --success:#16a34a;
  --danger:#dc2626;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,sans-serif;}
body{
  background:var(--bg);
  padding:20px;
}

header{
  text-align:center;
  margin-bottom:18px;
  font-size:22px;
  font-weight:600;
  color:var(--pri);
}

.container{
  max-width:500px;
  margin:auto;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:16px;
  border:1px solid var(--border);
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  margin-bottom:18px;
}

/* INPUT FIELD */
.input-group{
  margin-bottom:16px;
}

label{
  display:block;
  margin-bottom:6px;
  font-weight:500;
  color:var(--txt);
}

input[type="text"],
input[type="number"],
input[type="file"],
input[type="date"]{
  width:100%;
  padding:12px 14px;
  border:1px solid var(--border);
  border-radius:10px;
  font-size:15px;
  outline:none;
  transition:.2s;
}

input:focus{
  border-color:var(--pri);
  box-shadow:0 0 0 3px rgba(45,124,255,.15);
}

button{
  width:100%;
  padding:14px;
  background:var(--pri);
  color:#fff;
  font-size:17px;
  font-weight:600;
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition:.15s;
}

button:hover{
  background:#1f5fcc;
}

/* PREVIEW FOTO */
#preview{
  width:100%;
  border-radius:10px;
  margin-top:8px;
  object-fit:cover;
  max-height:240px;
}

.status{
  text-align:center;
  font-size:15px;
  margin-top:10px;
  font-weight:500;
}

.success{color:var(--success);}
.error{color:var(--danger);}
</style>
</head>

<body>

<header>Input Meter Petugas PDAM</header>

<div class="container card">

  <div class="input-group">
    <label>Tanggal Input</label>
    <input type="date" id="tanggal">
  </div>

  <div class="input-group">
    <label>Nomor Unit</label>
    <input type="text" id="unit" placeholder="Contoh: A-101">
  </div>

  <div class="input-group">
    <label>Meter Bulan Lalu</label>
    <input type="number" id="lalu" placeholder="0">
  </div>

  <div class="input-group">
    <label>Meter Bulan Ini</label>
    <input type="number" id="ini" placeholder="0">
  </div>

  <div class="input-group">
    <label>Foto Meter</label>
    <input type="file" id="foto" accept="image/*">
    <img id="preview" style="display:none">
  </div>

  <button onclick="save()">Simpan Data</button>

  <div id="status" class="status"></div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx-RUXa9NRf5GPRjouhdBwGSDJD9Gv8Am-TeqbV2D0gFBwSuNzlTx4blySQJFRM00tF/exec";
const TOKEN=sessionStorage.token;
const ROLE=sessionStorage.role;

if(!TOKEN || ROLE!=="petugas"){
  location.href="index.html";
}

// preview foto
foto.onchange = () => {
  const file = foto.files[0];
  if(file){
    preview.src = URL.createObjectURL(file);
    preview.style.display="block";
  }
};

async function save(){
  status.textContent="";
  status.className="status";

  if(!tanggal.value || !unit.value || !lalu.value || !ini.value){
    status.textContent="Semua field harus diisi.";
    status.classList.add("error");
    return;
  }

  let form = new FormData();
  form.append("mode","add");
  form.append("token",TOKEN);
  form.append("tanggal",tanggal.value);
  form.append("unit",unit.value);
  form.append("lalu",lalu.value);
  form.append("ini",ini.value);
  if(foto.files[0]) form.append("foto",foto.files[0]);

  status.textContent="Menyimpan...";
  let res = await fetch(API, {method:"POST", body:form});
  let r = await res.json();

  if(r.status==="success"){
    status.textContent="✔ Data berhasil disimpan!";
    status.classList.add("success");
    // reset form
    setTimeout(()=>location.reload(),1500);
  } else {
    status.textContent="✘ Gagal menyimpan! " + (r.message||"");
    status.classList.add("error");
  }
}
</script>

</body>
</html>
