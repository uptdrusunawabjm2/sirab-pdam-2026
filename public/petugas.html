<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Input Meter PDAM</title>
</head>
<body>

<h2>INPUT METER</h2>

<input id="unit" placeholder="No Unit"><br><br>
<input id="lalu" type="number" placeholder="Meter Lalu"><br><br>
<input id="ini" type="number" placeholder="Meter Ini"><br><br>
<input id="foto" type="file" accept="image/*"><br><br>

<button onclick="kirim()">SIMPAN</button>

<script>
const API="https://script.google.com/macros/s/AKfycbwy8MDN7v6zH-5WbBIN3YVm0q0AchlT8y7zP7_H0nAkH3WhkeogXfzHoB_IZsHF3NSGug/exec";
const TOKEN=sessionStorage.token;
if(!TOKEN) location.href="index.html";

async function kirim(){
const reader=new FileReader();
reader.onload=async()=>{
const base64=reader.result.split(",")[1];

const fd1=new FormData();
fd1.append("data",JSON.stringify({
action:"upload",
filename:Date.now()+".jpg",
base64:base64,
type:"image/jpeg"
}));
const up=await fetch(API,{method:"POST",body:fd1}).then(r=>r.json());

const fd2=new FormData();
fd2.append("data",JSON.stringify({
mode:"input",
token:TOKEN,
values:[new Date(),unit.value,lalu.value,ini.value,"","",up.url]
}));
await fetch(API,{method:"POST",body:fd2});

alert("Data tersimpan");
};
reader.readAsDataURL(foto.files[0]);
}
</script>

</body>
</html>
