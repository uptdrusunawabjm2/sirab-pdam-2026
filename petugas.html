<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login PDAM</title>

<style>
*{box-sizing:border-box}
body{
margin:0;
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
background:radial-gradient(circle at top,#0ea5e9,#020617 60%);
font-family:Segoe UI,Arial;
color:white;
}

.login-box{
width:380px;
padding:28px;
border-radius:20px;
background:rgba(2,6,23,.85);
backdrop-filter:blur(12px);
box-shadow:0 20px 60px rgba(0,0,0,.6);
}

.login-box h1{
margin:0 0 6px;
font-size:26px;
text-align:center;
}

.login-box p{
margin:0 0 20px;
text-align:center;
color:#94a3b8;
font-size:14px;
}

label{font-size:13px;color:#94a3b8}

input{
width:100%;
padding:12px;
margin-top:6px;
margin-bottom:14px;
border-radius:12px;
border:1px solid #1e293b;
background:#020617;
color:white;
font-size:15px;
}

input:focus{outline:none;border-color:#38bdf8}

button{
width:100%;
padding:13px;
border:none;
border-radius:14px;
background:linear-gradient(135deg,#38bdf8,#0ea5e9);
font-weight:700;
font-size:15px;
cursor:pointer;
}

button:disabled{
opacity:.6;
cursor:not-allowed;
}

#msg{
margin-top:12px;
text-align:center;
font-size:14px;
min-height:18px;
}

.ok{color:#22c55e}
.err{color:#ef4444}

.loader{
display:inline-block;
width:18px;height:18px;
border:3px solid rgba(255,255,255,.3);
border-top:3px solid white;
border-radius:50%;
animation:spin 1s linear infinite;
vertical-align:middle;
}

@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="login-box">
<h1>LOGIN PETUGAS</h1>
<p>Sistem Manajemen Air Bersih</p>

<label>Username</label>
<input id="u" placeholder="contoh: petugas1">

<label>Password</label>
<input id="p" type="password" placeholder="••••••••">

<button id="btn" onclick="login()">LOGIN</button>

<div id="msg"></div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx-RUXa9NRf5GPRjouhdBwGSDJD9Gv8Am-TeqbV2D0gFBwSuNzlTx4blySQJFRM00tF/exec";

async function login(){
 msg.innerHTML = '<span class="loader"></span> Menghubungkan...';
 btn.disabled = true;

 try{
   let res = await fetch(API,{
     method:"POST",
     body:JSON.stringify({
       action:"login",
       username:u.value.trim(),
       password:p.value
     })
   });

   let text = await res.text();

   let data;
   try{ data = JSON.parse(text); }
   catch{
     msg.innerHTML = "<span class='err'>Server tidak mengirim JSON</span>";
     btn.disabled=false;
     return;
   }

   if(!data.status){
     msg.innerHTML = "<span class='err'>Username / password salah</span>";
     btn.disabled=false;
     return;
   }

   sessionStorage.token = data.token;
   sessionStorage.role  = data.role;

   msg.innerHTML = "<span class='ok'>Login berhasil, membuka aplikasi...</span>";

   setTimeout(()=>{
     location.href = "app.html"; // atau index utama Anda
   },800);

 }catch(e){
   msg.innerHTML = "<span class='err'>Gagal terhubung ke server</span>";
   btn.disabled=false;
 }
}
</script>
</body>
</html>
